networks:
  monitor-net:

services:
  grafana:
    image: grafana/grafana:12.1.0
    container_name: grafana
    ports:
      - "3000:3000"
    env_file:
      - .env.monitor
    volumes:
      - grafana-data:/var/lib/grafana
    networks:
      - monitor-net
    restart: unless-stopped

  prometheus-dev:
    image: prom/prometheus:v3.5.0
    container_name: prometheus-dev
    ports:
      - "9091:9090"
    volumes:
      - ./dev/prometheus-dev.yml:/etc/prometheus/prometheus.yml
      - ./dev/targets-dev.json:/etc/prometheus/targets-dev.json
      - prometheus-dev-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    networks:
      - monitor-net
    restart: unless-stopped

  prometheus-prod:
    image: prom/prometheus:v3.5.0
    container_name: prometheus-prod
    ports:
      - "9090:9090"
    volumes:
      - ./prod/prometheus-prod.yml:/etc/prometheus/prometheus.yml
      - ./prod/targets-prod.json:/etc/prometheus/targets-prod.json
      - prometheus-prod-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    networks:
      - monitor-net
    restart: unless-stopped

  loki-dev:
    image: grafana/loki:3.5.0
    container_name: loki-dev
    ports:
      - "3101:3100"
    volumes:
      - ./dev/loki-dev-config.yml:/etc/loki/config.yml:ro
      - loki-dev-data:/loki
    command: ["-config.file", "/etc/loki/config.yml"]
    networks:
      - monitor-net
    restart: unless-stopped

  loki-prod:
    image: grafana/loki:3.5.0
    container_name: loki-prod
    ports:
      - "3100:3100"
    volumes:
      - ./prod/loki-prod-config.yml:/etc/loki/config.yml:ro
      - loki-prod-data:/loki
    command: ["-config.file", "/etc/loki/config.yml"]
    networks:
      - monitor-net
    restart: unless-stopped

  nginx-monitor:
    image: nginx:latest
    container_name: nginx-monitor
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
    networks:
      - monitor-net
    restart: unless-stopped

volumes:
  grafana-data:
  prometheus-dev-data:
  prometheus-prod-data:
  loki-dev-data:
  loki-prod-data:
